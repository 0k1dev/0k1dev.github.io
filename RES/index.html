// Th√™m v√†o ph·∫ßn JavaScript hi·ªán c√≥

// Report Management Data
let reportTemplates = {
    daily_summary: {
        name: "B√°o C√°o T·ªïng H·ª£p H√†ng Ng√†y",
        type: "daily",
        sections: ["summary", "revenue", "occupancy", "orders", "activities"]
    },
    monthly_financial: {
        name: "B√°o C√°o T√†i Ch√≠nh Th√°ng",
        type: "monthly",
        sections: ["financial_summary", "revenue_trend", "expense_breakdown", "profit_analysis", "comparisons"]
    },
    customer_analysis: {
        name: "Ph√¢n T√≠ch Kh√°ch H√†ng Chi Ti·∫øt",
        type: "analysis",
        sections: ["customer_segments", "vip_analysis", "behavior_patterns", "loyalty_program", "recommendations"]
    },
    room_performance: {
        name: "B√°o C√°o Hi·ªáu Su·∫•t Ph√≤ng",
        type: "performance",
        sections: ["occupancy_rates", "revenue_by_room", "popular_rooms", "seasonal_trends", "optimization"]
    },
    staff_performance: {
        name: "B√°o C√°o Hi·ªáu Su·∫•t Nh√¢n Vi√™n",
        type: "performance",
        sections: ["kpi_overview", "attendance", "customer_ratings", "productivity", "training_needs"]
    },
    inventory_report: {
        name: "B√°o C√°o Qu·∫£n L√Ω T·ªìn Kho",
        type: "inventory",
        sections: ["stock_levels", "consumption", "reorder_points", "wastage", "optimization"]
    }
};

let savedReports = [];

// Initialize report management
function initializeReportManagement() {
    // Load saved reports from localStorage
    const saved = localStorage.getItem('hotel_saved_reports');
    if (saved) {
        savedReports = JSON.parse(saved);
        updateSavedReportsList();
    }
    
    // Setup event listeners
    document.getElementById('reportPeriodSelect').addEventListener('change', function() {
        const customRange = document.getElementById('customDateRange');
        customRange.style.display = this.value === 'custom' ? 'block' : 'none';
    });
}

// Generate comprehensive report
function generateReport() {
    const reportType = document.getElementById('reportTypeSelect').value;
    const reportPeriod = document.getElementById('reportPeriodSelect').value;
    const filter = document.getElementById('reportFilterSelect').value;
    
    // Get date range
    let startDate, endDate;
    if (reportPeriod === 'custom') {
        startDate = document.getElementById('startDate').value;
        endDate = document.getElementById('endDate').value;
    } else {
        const today = new Date();
        switch(reportPeriod) {
            case 'daily':
                startDate = endDate = today.toISOString().split('T')[0];
                break;
            case 'weekly':
                startDate = new Date(today.setDate(today.getDate() - 7)).toISOString().split('T')[0];
                endDate = new Date().toISOString().split('T')[0];
                break;
            case 'monthly':
                startDate = new Date(today.setMonth(today.getMonth() - 1)).toISOString().split('T')[0];
                endDate = new Date().toISOString().split('T')[0];
                break;
            case 'quarterly':
                startDate = new Date(today.setMonth(today.getMonth() - 3)).toISOString().split('T')[0];
                endDate = new Date().toISOString().split('T')[0];
                break;
            case 'yearly':
                startDate = new Date(today.setFullYear(today.getFullYear() - 1)).toISOString().split('T')[0];
                endDate = new Date().toISOString().split('T')[0];
                break;
        }
    }
    
    // Generate report based on type
    let reportHTML = '';
    switch(reportType) {
        case 'financial':
            reportHTML = generateFinancialReport(startDate, endDate, filter);
            break;
        case 'occupancy':
            reportHTML = generateOccupancyReport(startDate, endDate, filter);
            break;
        case 'customer':
            reportHTML = generateCustomerReport(startDate, endDate, filter);
            break;
        case 'service':
            reportHTML = generateServiceReport(startDate, endDate, filter);
            break;
        case 'staff':
            reportHTML = generateStaffReport(startDate, endDate, filter);
            break;
        case 'inventory':
            reportHTML = generateInventoryReport(startDate, endDate, filter);
            break;
    }
    
    // Display report
    const reportArea = document.getElementById('reportDisplayArea');
    reportArea.innerHTML = reportHTML;
    reportArea.style.display = 'block';
    
    // Scroll to report
    reportArea.scrollIntoView({ behavior: 'smooth' });
    
    // Save to history
    saveReportToHistory(reportType, reportPeriod, new Date());
}

// Generate Financial Report
function generateFinancialReport(startDate, endDate, filter) {
    // Calculate financial data based on filter
    let filteredRooms = rooms;
    if (filter === 'vip') filteredRooms = rooms.filter(r => r.type === 'vip');
    if (filter === 'standard') filteredRooms = rooms.filter(r => r.type === 'standard');
    if (filter === 'suite') filteredRooms = rooms.filter(r => r.type === 'suite');
    if (filter === 'floor1-3') filteredRooms = rooms.filter(r => r.floor >= 1 && r.floor <= 3);
    if (filter === 'floor4-7') filteredRooms = rooms.filter(r => r.floor >= 4 && r.floor <= 7);
    
    // Calculate revenue from rooms
    const roomRevenue = filteredRooms.reduce((sum, room) => {
        if (room.checkinTime) {
            const checkinDate = new Date(room.checkinTime).toISOString().split('T')[0];
            if (checkinDate >= startDate && checkinDate <= endDate) {
                const hasPromo = room.badges.some(b => b.type === 'promo');
                const dailyRate = hasPromo ? room.pricePerDay * 0.8 : room.pricePerDay;
                return sum + (dailyRate * room.numDays);
            }
        }
        return sum;
    }, 0);
    
    // Calculate revenue from orders
    const orderRevenue = orders.reduce((sum, order) => {
        const orderDate = new Date(order.time).toISOString().split('T')[0];
        if (orderDate >= startDate && orderDate <= endDate) {
            // Check if room matches filter
            const room = rooms.find(r => r.roomNumber == order.roomId);
            if (room && isRoomInFilter(room, filter)) {
                return sum + (order.total || 0);
            }
        }
        return sum;
    }, 0);
    
    const totalRevenue = roomRevenue + orderRevenue;
    
    // Calculate expenses (simplified)
    const staffExpenses = managementData.staffMembers.reduce((sum, staff) => sum + staff.salary, 0);
    const operationalExpenses = totalRevenue * 0.3; // 30% of revenue
    const totalExpenses = staffExpenses + operationalExpenses;
    
    const profit = totalRevenue - totalExpenses;
    const profitMargin = totalRevenue > 0 ? (profit / totalRevenue * 100).toFixed(1) : 0;
    
    // Calculate comparisons
    const previousPeriodRevenue = totalRevenue * 0.85; // Simulated 15% less
    const revenueChange = ((totalRevenue - previousPeriodRevenue) / previousPeriodRevenue * 100).toFixed(1);
    
    return `
        <div class="report-section">
            <div class="report-header">
                <h2 style="margin: 0; color: white;"><i class="fas fa-file-invoice-dollar"></i> B√ÅO C√ÅO T√ÄI CH√çNH</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9;">${formatDateRange(startDate, endDate)} | ${getFilterName(filter)}</p>
            </div>
            
            <!-- Executive Summary -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="report-stat">
                    <div class="label">T·ªïng Doanh Thu</div>
                    <div class="value" style="color: #27ae60;">${formatCurrency(totalRevenue)}</div>
                    <div class="comparison-badge ${revenueChange >= 0 ? 'comparison-positive' : 'comparison-negative'}">
                        ${revenueChange >= 0 ? '+' : ''}${revenueChange}% so v·ªõi k·ª≥ tr∆∞·ªõc
                    </div>
                </div>
                
                <div class="report-stat">
                    <div class="label">T·ªïng Chi Ph√≠</div>
                    <div class="value" style="color: #e74c3c;">${formatCurrency(totalExpenses)}</div>
                    <div class="label">Trong ƒë√≥: Nh√¢n s·ª± ${formatCurrency(staffExpenses)}</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">L·ª£i Nhu·∫≠n</div>
                    <div class="value" style="color: ${profit >= 0 ? '#27ae60' : '#e74c3c'};">${formatCurrency(profit)}</div>
                    <div class="label">T·ª∑ su·∫•t l·ª£i nhu·∫≠n: ${profitMargin}%</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">Doanh Thu TB/Ng√†y</div>
                    <div class="value" style="color: #3498db;">${formatCurrency(totalRevenue / getDaysBetween(startDate, endDate))}</div>
                    <div class="label">${getDaysBetween(startDate, endDate)} ng√†y</div>
                </div>
            </div>
            
            <!-- Revenue Breakdown -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-chart-pie"></i> Ph√¢n B·ªï Doanh Thu
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <div>
                    <h4 style="color: #666; margin-bottom: 15px;">Theo Ngu·ªìn Thu</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Ph√≤ng ·ªêc</span>
                                <span style="font-weight: bold;">${formatCurrency(roomRevenue)}</span>
                            </div>
                            <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden;">
                                <div style="width: ${totalRevenue > 0 ? (roomRevenue / totalRevenue * 100) : 0}%; height: 100%; background: #3498db;"></div>
                            </div>
                            <div style="text-align: right; font-size: 0.9em; color: #666; margin-top: 5px;">
                                ${totalRevenue > 0 ? ((roomRevenue / totalRevenue * 100).toFixed(1)) : 0}%
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Nh√† H√†ng</span>
                                <span style="font-weight: bold;">${formatCurrency(orderRevenue)}</span>
                            </div>
                            <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden;">
                                <div style="width: ${totalRevenue > 0 ? (orderRevenue / totalRevenue * 100) : 0}%; height: 100%; background: #27ae60;"></div>
                            </div>
                            <div style="text-align: right; font-size: 0.9em; color: #666; margin-top: 5px;">
                                ${totalRevenue > 0 ? ((orderRevenue / totalRevenue * 100).toFixed(1)) : 0}%
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 style="color: #666; margin-bottom: 15px;">Theo Lo·∫°i Ph√≤ng</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        ${['standard', 'vip', 'suite'].map(type => {
                            const typeRevenue = filteredRooms
                                .filter(r => r.type === type)
                                .reduce((sum, room) => {
                                    if (room.checkinTime) {
                                        const checkinDate = new Date(room.checkinTime).toISOString().split('T')[0];
                                        if (checkinDate >= startDate && checkinDate <= endDate) {
                                            const hasPromo = room.badges.some(b => b.type === 'promo');
                                            const dailyRate = hasPromo ? room.pricePerDay * 0.8 : room.pricePerDay;
                                            return sum + (dailyRate * room.numDays);
                                        }
                                    }
                                    return sum;
                                }, 0);
                            
                            const colors = { standard: '#3498db', vip: '#f1c40f', suite: '#9b59b6' };
                            const names = { standard: 'Ti√™u Chu·∫©n', vip: 'VIP', suite: 'Suite' };
                            
                            return `
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span>${names[type]}</span>
                                        <span style="font-weight: bold;">${formatCurrency(typeRevenue)}</span>
                                    </div>
                                    <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden;">
                                        <div style="width: ${roomRevenue > 0 ? (typeRevenue / roomRevenue * 100) : 0}%; height: 100%; background: ${colors[type]};"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            </div>
            
            <!-- Financial Trends -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-chart-line"></i> Xu H∆∞·ªõng T√†i Ch√≠nh
            </h3>
            
            <div class="report-chart" id="financialTrendChart">
                <!-- Chart will be generated dynamically -->
                ${generateFinancialTrendChart(startDate, endDate)}
            </div>
            
            <!-- Expense Breakdown -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-money-bill-wave"></i> Ph√¢n T√≠ch Chi Ph√≠
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #e74c3c; margin-bottom: 15px;">Chi Ph√≠ Nh√¢n S·ª±</h4>
                    <div style="font-size: 2em; font-weight: bold; color: #e74c3c; margin-bottom: 10px;">
                        ${formatCurrency(staffExpenses)}
                    </div>
                    <div style="color: #666;">
                        ${managementData.staffMembers.length} nh√¢n vi√™n<br>
                        Trung b√¨nh: ${formatCurrency(staffExpenses / managementData.staffMembers.length)}/ng∆∞·ªùi
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #f39c12; margin-bottom: 15px;">Chi Ph√≠ V·∫≠t T∆∞</h4>
                    <div style="font-size: 2em; font-weight: bold; color: #f39c12; margin-bottom: 10px;">
                        ${formatCurrency(operationalExpenses * 0.4)}
                    </div>
                    <div style="color: #666;">
                        40% chi ph√≠ v·∫≠n h√†nh<br>
                        Ch·ªß y·∫øu: Th·ª±c ph·∫©m, v·ªá sinh
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #9b59b6; margin-bottom: 15px;">Chi Ph√≠ Kh√°c</h4>
                    <div style="font-size: 2em; font-weight: bold; color: #9b59b6; margin-bottom: 10px;">
                        ${formatCurrency(operationalExpenses * 0.6)}
                    </div>
                    <div style="color: #666;">
                        60% chi ph√≠ v·∫≠n h√†nh<br>
                        ƒêi·ªán, n∆∞·ªõc, b·∫£o tr√¨, marketing
                    </div>
                </div>
            </div>
            
            <!-- Key Insights -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-lightbulb"></i> Ph√¢n T√≠ch & ƒê·ªÅ Xu·∫•t
            </h3>
            
            <div style="margin-bottom: 30px;">
                <div class="insight-card ${profitMargin >= 20 ? 'success' : profitMargin >= 10 ? 'warning' : 'danger'}">
                    <h4 style="margin: 0 0 10px 0;">
                        <i class="fas ${profitMargin >= 20 ? 'fa-check-circle' : profitMargin >= 10 ? 'fa-exclamation-triangle' : 'fa-exclamation-circle'}"></i>
                        T·ª∑ Su·∫•t L·ª£i Nhu·∫≠n: ${profitMargin}%
                    </h4>
                    <p style="margin: 0;">
                        ${profitMargin >= 20 ? 
                            'T·ª∑ su·∫•t l·ª£i nhu·∫≠n r·∫•t t·ªët. Ti·∫øp t·ª•c duy tr√¨ hi·ªáu qu·∫£ v·∫≠n h√†nh.' :
                          profitMargin >= 10 ?
                            'T·ª∑ su·∫•t l·ª£i nhu·∫≠n ·ªü m·ª©c trung b√¨nh. C·∫ßn t·ªëi ∆∞u chi ph√≠.' :
                            'T·ª∑ su·∫•t l·ª£i nhu·∫≠n th·∫•p. C·∫ßn xem x√©t l·∫°i chi·∫øn l∆∞·ª£c gi√° v√† ki·ªÉm so√°t chi ph√≠.'
                        }
                    </p>
                </div>
                
                <div class="insight-card ${roomRevenue > orderRevenue * 2 ? 'success' : 'warning'}">
                    <h4 style="margin: 0 0 10px 0;">
                        <i class="fas ${roomRevenue > orderRevenue * 2 ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
                        C∆° C·∫•u Doanh Thu
                    </h4>
                    <p style="margin: 0;">
                        ${roomRevenue > orderRevenue * 2 ?
                            'Doanh thu ph√≤ng chi·∫øm ∆∞u th·∫ø. Tuy nhi√™n n√™n ph√°t tri·ªÉn th√™m d·ªãch v·ª• nh√† h√†ng.' :
                            'Doanh thu nh√† h√†ng ƒë√≥ng g√≥p ƒë√°ng k·ªÉ. Ti·∫øp t·ª•c ph√°t huy th·∫ø m·∫°nh d·ªãch v·ª• ƒÉn u·ªëng.'
                        }
                    </p>
                </div>
                
                <div class="insight-card ${revenueChange >= 0 ? 'success' : 'danger'}">
                    <h4 style="margin: 0 0 10px 0;">
                        <i class="fas ${revenueChange >= 0 ? 'fa-chart-line' : 'fa-chart-line-down'}"></i>
                        TƒÉng Tr∆∞·ªüng Doanh Thu: ${revenueChange}%
                    </h4>
                    <p style="margin: 0;">
                        ${revenueChange >= 0 ?
                            `Doanh thu tƒÉng ${revenueChange}% so v·ªõi k·ª≥ tr∆∞·ªõc. Xu h∆∞·ªõng t√≠ch c·ª±c.` :
                            `Doanh thu gi·∫£m ${Math.abs(revenueChange)}% so v·ªõi k·ª≥ tr∆∞·ªõc. C·∫ßn ph√¢n t√≠ch nguy√™n nh√¢n.`
                        }
                    </p>
                </div>
            </div>
            
            <!-- Recommendations -->
            <div style="background: #e8f4fc; padding: 20px; border-radius: 10px; border-left: 4px solid #3498db;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50;">
                    <i class="fas fa-bullseye"></i> ƒê·ªÅ Xu·∫•t H√†nh ƒê·ªông
                </h4>
                <ul style="margin: 0; padding-left: 20px;">
                    ${profitMargin < 15 ? '<li>Ki·ªÉm so√°t ch·∫∑t chi ph√≠ v·∫≠n h√†nh, ƒë·∫∑c bi·ªát l√† ƒëi·ªán n∆∞·ªõc</li>' : ''}
                    ${roomRevenue > orderRevenue * 3 ? '<li>ƒê·∫©y m·∫°nh d·ªãch v·ª• nh√† h√†ng v·ªõi combo khuy·∫øn m√£i</li>' : ''}
                    ${revenueChange < 5 ? '<li>TƒÉng c∆∞·ªùng marketing m√πa th·∫•p ƒëi·ªÉm</li>' : ''}
                    <li>T·ªëi ∆∞u h√≥a gi√° ph√≤ng theo m√πa v√† ƒë·ªëi th·ªß</li>
                    <li>Ph√°t tri·ªÉn g√≥i d·ªãch v·ª• cao c·∫•p cho kh√°ch VIP</li>
                    <li>ƒê√†o t·∫°o nh√¢n vi√™n n√¢ng cao ch·∫•t l∆∞·ª£ng d·ªãch v·ª•</li>
                </ul>
            </div>
            
            <!-- Footer -->
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef; color: #666; font-size: 0.9em;">
                <p>B√°o c√°o ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông v√†o ${new Date().toLocaleString('vi-VN')}</p>
                <p>H·ªá th·ªëng Qu·∫£n l√Ω Kh√°ch s·∫°n Horizon - Phi√™n b·∫£n 2.0</p>
            </div>
        </div>
    `;
}

// Generate Occupancy Report
function generateOccupancyReport(startDate, endDate, filter) {
    // Calculate occupancy data
    const totalRooms = rooms.length;
    let filteredRooms = rooms;
    
    if (filter === 'floor1-3') filteredRooms = rooms.filter(r => r.floor >= 1 && r.floor <= 3);
    if (filter === 'floor4-7') filteredRooms = rooms.filter(r => r.floor >= 4 && r.floor <= 7);
    
    const totalFilteredRooms = filteredRooms.length;
    
    // Calculate occupancy rates
    const occupiedRooms = filteredRooms.filter(r => r.status === 'occupied').length;
    const cleaningRooms = filteredRooms.filter(r => r.status === 'cleaning').length;
    const availableRooms = totalFilteredRooms - occupiedRooms - cleaningRooms;
    
    const occupancyRate = totalFilteredRooms > 0 ? (occupiedRooms / totalFilteredRooms * 100).toFixed(1) : 0;
    const cleaningRate = totalFilteredRooms > 0 ? (cleaningRooms / totalFilteredRooms * 100).toFixed(1) : 0;
    const availabilityRate = totalFilteredRooms > 0 ? (availableRooms / totalFilteredRooms * 100).toFixed(1) : 0;
    
    // Calculate by room type
    const roomTypeStats = {};
    ['standard', 'vip', 'suite'].forEach(type => {
        const typeRooms = filteredRooms.filter(r => r.type === type);
        const occupiedTypeRooms = typeRooms.filter(r => r.status === 'occupied').length;
        roomTypeStats[type] = {
            total: typeRooms.length,
            occupied: occupiedTypeRooms,
            rate: typeRooms.length > 0 ? (occupiedTypeRooms / typeRooms.length * 100).toFixed(1) : 0
        };
    });
    
    // Calculate by floor
    const floorStats = {};
    for (let floor = 1; floor <= 7; floor++) {
        const floorRooms = filteredRooms.filter(r => r.floor === floor);
        const occupiedFloorRooms = floorRooms.filter(r => r.status === 'occupied').length;
        floorStats[floor] = {
            total: floorRooms.length,
            occupied: occupiedFloorRooms,
            rate: floorRooms.length > 0 ? (occupiedFloorRooms / floorRooms.length * 100).toFixed(1) : 0
        };
    }
    
    // Find most popular rooms
    const popularRooms = [...filteredRooms]
        .sort((a, b) => b.bookingCount - a.bookingCount)
        .slice(0, 5);
    
    return `
        <div class="report-section">
            <div class="report-header">
                <h2 style="margin: 0; color: white;"><i class="fas fa-bed"></i> B√ÅO C√ÅO PH√íNG ·ªêC</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9;">${formatDateRange(startDate, endDate)} | ${getFilterName(filter)}</p>
            </div>
            
            <!-- Occupancy Overview -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="report-stat">
                    <div class="label">T·ª∑ L·ªá Thu√™ Ph√≤ng</div>
                    <div class="value" style="color: #27ae60;">${occupancyRate}%</div>
                    <div class="label">${occupiedRooms}/${totalFilteredRooms} ph√≤ng</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">Ph√≤ng ƒêang D·ªçn</div>
                    <div class="value" style="color: #f39c12;">${cleaningRate}%</div>
                    <div class="label">${cleaningRooms} ph√≤ng</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">Ph√≤ng Tr·ªëng</div>
                    <div class="value" style="color: #3498db;">${availabilityRate}%</div>
                    <div class="label">${availableRooms} ph√≤ng s·∫µn s√†ng</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">T·ªïng S·ªë Ph√≤ng</div>
                    <div class="value" style="color: #9b59b6;">${totalFilteredRooms}</div>
                    <div class="label">${totalRooms} ph√≤ng to√†n kh√°ch s·∫°n</div>
                </div>
            </div>
            
            <!-- Occupancy by Room Type -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-chart-pie"></i> T·ª∑ L·ªá Thu√™ Theo Lo·∫°i Ph√≤ng
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                ${['standard', 'vip', 'suite'].map(type => {
                    const stats = roomTypeStats[type];
                    const colors = { standard: '#3498db', vip: '#f1c40f', suite: '#9b59b6' };
                    const names = { standard: 'Ti√™u Chu·∫©n', vip: 'VIP', suite: 'Suite' };
                    
                    return `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0; color: ${colors[type]};">${names[type]}</h4>
                                <span style="font-size: 1.5em; font-weight: bold;">${stats.rate}%</span>
                            </div>
                            <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; margin-bottom: 10px;">
                                <div style="width: ${stats.rate}%; height: 100%; background: ${colors[type]};"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; color: #666; font-size: 0.9em;">
                                <span>${stats.occupied}/${stats.total} ph√≤ng</span>
                                <span>${stats.total > 0 ? ((stats.occupied / stats.total * 100).toFixed(1)) : 0}%</span>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            <!-- Occupancy by Floor -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-building"></i> T·ª∑ L·ªá Thu√™ Theo T·∫ßng
            </h3>
            
            <div class="report-chart">
                ${Object.keys(floorStats).map(floor => {
                    const stats = floorStats[floor];
                    const height = stats.total > 0 ? (stats.rate / 100 * 80) + 20 : 20;
                    
                    return `
                        <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                            <div style="width: 80%; height: ${height}%; background: linear-gradient(to top, #27ae60, #2ecc71); border-radius: 5px 5px 0 0; position: relative;">
                                <div style="position: absolute; top: -25px; left: 0; right: 0; text-align: center; font-size: 0.9em; font-weight: bold;">
                                    ${stats.rate}%
                                </div>
                            </div>
                            <div style="margin-top: 5px; font-size: 0.9em; color: #666;">
                                T·∫ßng ${floor}<br>
                                <small>${stats.occupied}/${stats.total}</small>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            <!-- Most Popular Rooms -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-star"></i> Ph√≤ng Ph·ªï Bi·∫øn Nh·∫•t
            </h3>
            
            <div style="overflow-x: auto; margin-bottom: 30px;">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>S·ªë Ph√≤ng</th>
                            <th>Lo·∫°i</th>
                            <th>T·∫ßng</th>
                            <th>S·ªë L·∫ßn Thu√™</th>
                            <th>T·ª∑ L·ªá Thu√™</th>
                            <th>Doanh Thu</th>
                            <th>ƒê√°nh Gi√°</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${popularRooms.map((room, index) => `
                            <tr>
                                <td>${index + 1}</td>
                                <td><strong>${room.roomNumber}</strong></td>
                                <td><span class="room-type type-${room.type}">${ROOM_TYPES[room.type].name}</span></td>
                                <td>T·∫ßng ${room.floor}</td>
                                <td>${room.bookingCount}</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span>${room.occupancyRate}%</span>
                                        <div style="flex: 1; height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden;">
                                            <div style="width: ${room.occupancyRate}%; height: 100%; background: #27ae60;"></div>
                                        </div>
                                    </div>
                                </td>
                                <td>${formatCurrency(room.totalRevenue)}</td>
                                <td>
                                    ${room.occupancyRate >= 80 ? '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê' :
                                      room.occupancyRate >= 60 ? '‚≠ê‚≠ê‚≠ê‚≠ê' :
                                      room.occupancyRate >= 40 ? '‚≠ê‚≠ê‚≠ê' :
                                      room.occupancyRate >= 20 ? '‚≠ê‚≠ê' : '‚≠ê'}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            
            <!-- Room Performance Insights -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-chart-line"></i> Ph√¢n T√≠ch Hi·ªáu Su·∫•t
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- Best Performing Room -->
                <div style="background: #d4edda; padding: 20px; border-radius: 10px; border-left: 4px solid #27ae60;">
                    <h4 style="margin: 0 0 10px 0; color: #155724;">
                        <i class="fas fa-trophy"></i> Ph√≤ng T·ªët Nh·∫•t
                    </h4>
                    ${(() => {
                        const bestRoom = popularRooms[0];
                        return bestRoom ? `
                            <p style="margin: 0 0 10px 0;">
                                <strong>Ph√≤ng ${bestRoom.roomNumber}</strong><br>
                                T·ª∑ l·ªá thu√™: ${bestRoom.occupancyRate}%<br>
                                Doanh thu: ${formatCurrency(bestRoom.totalRevenue)}<br>
                                S·ªë l·∫ßn thu√™: ${bestRoom.bookingCount}
                            </p>
                        ` : '<p style="margin: 0;">Kh√¥ng c√≥ d·ªØ li·ªáu</p>';
                    })()}
                </div>
                
                <!-- Underperforming Rooms -->
                <div style="background: #f8d7da; padding: 20px; border-radius: 10px; border-left: 4px solid #e74c3c;">
                    <h4 style="margin: 0 0 10px 0; color: #721c24;">
                        <i class="fas fa-exclamation-triangle"></i> C·∫ßn C·∫£i Thi·ªán
                    </h4>
                    ${(() => {
                        const underperforming = filteredRooms
                            .filter(r => r.occupancyRate < 30)
                            .slice(0, 3);
                        
                        if (underperforming.length > 0) {
                            return `
                                <p style="margin: 0 0 10px 0;">
                                    ${underperforming.map(r => `Ph√≤ng ${r.roomNumber} (${r.occupancyRate}%)`).join(', ')}
                                </p>
                                <p style="margin: 0; font-size: 0.9em;">
                                    C·∫ßn xem x√©t: ƒëi·ªÅu ch·ªânh gi√°, c·∫£i thi·ªán ti·ªán nghi, tƒÉng c∆∞·ªùng marketing
                                </p>
                            `;
                        } else {
                            return '<p style="margin: 0;">Kh√¥ng c√≥ ph√≤ng n√†o c·∫ßn c·∫£i thi·ªán</p>';
                        }
                    })()}
                </div>
                
                <!-- Seasonal Analysis -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 4px solid #f39c12;">
                    <h4 style="margin: 0 0 10px 0; color: #856404;">
                        <i class="fas fa-calendar-alt"></i> Ph√¢n T√≠ch M√πa V·ª•
                    </h4>
                    <p style="margin: 0;">
                        ${occupancyRate >= 70 ? 
                            'M√πa cao ƒëi·ªÉm - TƒÉng gi√° t·ªëi ∆∞u doanh thu' :
                          occupancyRate >= 40 ?
                            'M√πa trung b√¨nh - √Åp d·ª•ng khuy·∫øn m√£i' :
                            'M√πa th·∫•p ƒëi·ªÉm - C·∫ßn chi·∫øn l∆∞·ª£c ƒë·∫∑c bi·ªát'
                        }
                    </p>
                    <p style="margin: 10px 0 0 0; font-size: 0.9em;">
                        ƒê·ªÅ xu·∫•t: ${occupancyRate >= 70 ? 
                            'M·ªü b√°n tr∆∞·ªõc, tƒÉng gi√° dynamic' :
                            'Combo d·ªãch v·ª•, khuy·∫øn m√£i d√†i h·∫°n'
                        }
                    </p>
                </div>
            </div>
            
            <!-- Recommendations -->
            <div style="background: #e8f4fc; padding: 20px; border-radius: 10px; border-left: 4px solid #3498db;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50;">
                    <i class="fas fa-bullseye"></i> Chi·∫øn L∆∞·ª£c T·ªëi ∆Øu
                </h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: #666;">üìà TƒÉng T·ª∑ L·ªá Thu√™</h5>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Dynamic pricing theo demand</li>
                            <li>Package d·ªãch v·ª• gi√° tr·ªã gia tƒÉng</li>
                            <li>Upsell ph√≤ng cao c·∫•p</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: #666;">üí∞ T·ªëi ∆Øu Doanh Thu</h5>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Ph√¢n kh√∫c gi√° theo t·∫ßng</li>
                            <li>Khuy·∫øn m√£i m√πa th·∫•p ƒëi·ªÉm</li>
                            <li>Bundle nh√† h√†ng + ph√≤ng</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: #666;">üéØ C·∫£i Thi·ªán Hi·ªáu Su·∫•t</h5>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Turnaround time d·ªçn ph√≤ng</li>
                            <li>Predictive maintenance</li>
                            <li>Staff training chuy√™n s√¢u</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef; color: #666; font-size: 0.9em;">
                <p>B√°o c√°o ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông v√†o ${new Date().toLocaleString('vi-VN')}</p>
                <p>Ch·ªâ s·ªë ƒë√°nh gi√° d·ª±a tr√™n d·ªØ li·ªáu l·ªãch s·ª≠ v√† ph√¢n t√≠ch th·ª±c t·∫ø</p>
            </div>
        </div>
    `;
}

// Generate Customer Analysis Report
function generateCustomerReport(startDate, endDate, filter) {
    // Customer statistics
    const vipCustomers = managementData.customerHistory.filter(c => c.isVip).length;
    const repeatCustomers = managementData.customerHistory.filter(c => c.visits > 1).length;
    const totalCustomers = managementData.customerHistory.length;
    
    // Calculate average spending
    const totalSpending = managementData.customerHistory.reduce((sum, c) => sum + c.totalSpent, 0);
    const avgSpending = totalCustomers > 0 ? totalSpending / totalCustomers : 0;
    
    // Customer segmentation
    const segments = {
        vip_high: managementData.customerHistory.filter(c => c.isVip && c.totalSpent > 10000000).length,
        vip_medium: managementData.customerHistory.filter(c => c.isVip && c.totalSpent <= 10000000).length,
        regular_high: managementData.customerHistory.filter(c => !c.isVip && c.totalSpent > 5000000).length,
        regular_low: managementData.customerHistory.filter(c => !c.isVip && c.totalSpent <= 5000000).length
    };
    
    // Room type preference
    const roomPreferences = {};
    managementData.customerHistory.forEach(customer => {
        if (!roomPreferences[customer.roomType]) {
            roomPreferences[customer.roomType] = 0;
        }
        roomPreferences[customer.roomType]++;
    });
    
    // Customer retention rate (simplified)
    const retentionRate = totalCustomers > 0 ? (repeatCustomers / totalCustomers * 100).toFixed(1) : 0;
    
    return `
        <div class="report-section">
            <div class="report-header">
                <h2 style="margin: 0; color: white;"><i class="fas fa-users"></i> PH√ÇN T√çCH KH√ÅCH H√ÄNG</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9;">${formatDateRange(startDate, endDate)} | ${getFilterName(filter)}</p>
            </div>
            
            <!-- Customer Overview -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="report-stat">
                    <div class="label">T·ªïng Kh√°ch H√†ng</div>
                    <div class="value" style="color: #3498db;">${totalCustomers}</div>
                    <div class="label">${new Date().getFullYear()}</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">Kh√°ch VIP</div>
                    <div class="value" style="color: #f1c40f;">${vipCustomers}</div>
                    <div class="label">${totalCustomers > 0 ? ((vipCustomers / totalCustomers * 100).toFixed(1)) : 0}%</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">Kh√°ch Quay L·∫°i</div>
                    <div class="value" style="color: #27ae60;">${repeatCustomers}</div>
                    <div class="label">T·ª∑ l·ªá gi·ªØ ch√¢n: ${retentionRate}%</div>
                </div>
                
                <div class="report-stat">
                    <div class="label">Chi Ti√™u Trung B√¨nh</div>
                    <div class="value" style="color: #9b59b6;">${formatCurrency(avgSpending)}</div>
                    <div class="label">T·ªïng: ${formatCurrency(totalSpending)}</div>
                </div>
            </div>
            
            <!-- Customer Segmentation -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-chart-pie"></i> Ph√¢n Kh√∫c Kh√°ch H√†ng
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                ${Object.entries({
                    'vip_high': { name: 'VIP Cao C·∫•p', color: '#f1c40f', description: 'Chi ti√™u > 10tr' },
                    'vip_medium': { name: 'VIP Trung B√¨nh', color: '#f39c12', description: 'Chi ti√™u ‚â§ 10tr' },
                    'regular_high': { name: 'Th∆∞·ªùng Cao', color: '#3498db', description: 'Chi ti√™u > 5tr' },
                    'regular_low': { name: 'Th∆∞·ªùng Th·∫•p', color: '#2980b9', description: 'Chi ti√™u ‚â§ 5tr' }
                }).map(([key, info]) => {
                    const count = segments[key];
                    const percentage = totalCustomers > 0 ? (count / totalCustomers * 100).toFixed(1) : 0;
                    
                    return `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid ${info.color};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: ${info.color};">${info.name}</h4>
                                <span style="font-size: 1.5em; font-weight: bold;">${count}</span>
                            </div>
                            <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9em;">${info.description}</p>
                            <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden;">
                                <div style="width: ${percentage}%; height: 100%; background: ${info.color};"></div>
                            </div>
                            <div style="text-align: right; margin-top: 5px; font-size: 0.9em; color: #666;">
                                ${percentage}% t·ªïng kh√°ch h√†ng
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            <!-- Room Type Preferences -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-bed"></i> Xu H∆∞·ªõng Ch·ªçn Ph√≤ng
            </h3>
            
            <div class="report-chart">
                ${Object.entries(roomPreferences).map(([type, count]) => {
                    const percentage = totalCustomers > 0 ? (count / totalCustomers * 100).toFixed(1) : 0;
                    const height = totalCustomers > 0 ? (percentage / 100 * 80) + 20 : 20;
                    const colors = { standard: '#3498db', vip: '#f1c40f', suite: '#9b59b6' };
                    const names = { standard: 'Ti√™u Chu·∫©n', vip: 'VIP', suite: 'Suite' };
                    
                    return `
                        <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                            <div style="width: 80%; height: ${height}%; background: ${colors[type]}; border-radius: 5px 5px 0 0; position: relative;">
                                <div style="position: absolute; top: -25px; left: 0; right: 0; text-align: center; font-size: 0.9em; font-weight: bold; color: ${colors[type]};">
                                    ${percentage}%
                                </div>
                            </div>
                            <div style="margin-top: 5px; font-size: 0.9em; color: #666; text-align: center;">
                                ${names[type]}<br>
                                <small>${count} kh√°ch</small>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            <!-- Top Customers -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-crown"></i> Kh√°ch H√†ng Gi√° Tr·ªã Nh·∫•t
            </h3>
            
            <div style="overflow-x: auto; margin-bottom: 30px;">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>H·∫°ng</th>
                            <th>T√™n Kh√°ch H√†ng</th>
                            <th>S·ªë L·∫ßn Thu√™</th>
                            <th>T·ªïng Chi Ti√™u</th>
                            <th>Lo·∫°i Ph√≤ng ∆Øa Th√≠ch</th>
                            <th>T√¨nh Tr·∫°ng VIP</th>
                            <th>ƒê·ªÅ Xu·∫•t</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${managementData.customerHistory
                            .sort((a, b) => b.totalSpent - a.totalSpent)
                            .slice(0, 10)
                            .map((customer, index) => `
                                <tr>
                                    <td>
                                        <div style="width: 30px; height: 30px; background: ${index < 3 ? '#f1c40f' : '#3498db'}; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                            ${index + 1}
                                        </div>
                                    </td>
                                    <td><strong>${customer.name}</strong></td>
                                    <td>${customer.visits} l·∫ßn</td>
                                    <td>${formatCurrency(customer.totalSpent)}</td>
                                    <td><span class="room-type type-${customer.roomType}">${ROOM_TYPES[customer.roomType]?.name || customer.roomType}</span></td>
                                    <td>
                                        <span class="status-badge ${customer.isVip ? 'status-active' : 'status-inactive'}">
                                            ${customer.isVip ? 'VIP' : 'Th∆∞·ªùng'}
                                        </span>
                                    </td>
                                    <td>
                                        ${customer.isVip ? 
                                            '<span style="color: #27ae60;">∆Øu ƒë√£i ƒë·∫∑c bi·ªát</span>' :
                                            customer.totalSpent > 5000000 ?
                                            '<span style="color: #3498db;">Xem x√©t n√¢ng VIP</span>' :
                                            '<span style="color: #666;">Khuy·∫øn m√£i th∆∞·ªùng</span>'
                                        }
                                    </td>
                                </tr>
                            `).join('')}
                    </tbody>
                </table>
            </div>
            
            <!-- Customer Behavior Analysis -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-brain"></i> Ph√¢n T√≠ch H√†nh Vi
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: #e8f4fc; padding: 20px; border-radius: 10px;">
                    <h4 style="margin: 0 0 15px 0; color: #3498db;">
                        <i class="fas fa-calendar-check"></i> M√¥ H√¨nh ƒê·∫∑t Ph√≤ng
                    </h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>60% ƒë·∫∑t tr∆∞·ªõc 7+ ng√†y</li>
                        <li>25% ƒë·∫∑t last-minute</li>
                        <li>15% walk-in</li>
                        <li>Trung b√¨nh: 3.2 ng√†y/l·∫ßn thu√™</li>
                    </ul>
                </div>
                
                <div style="background: #d4edda; padding: 20px; border-radius: 10px;">
                    <h4 style="margin: 0 0 15px 0; color: #27ae60;">
                        <i class="fas fa-utensils"></i> Ti√™u D√πng D·ªãch V·ª•
                    </h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>80% s·ª≠ d·ª•ng nh√† h√†ng</li>
                        <li>45% s·ª≠ d·ª•ng d·ªãch v·ª• ph√≤ng</li>
                        <li>30% ƒë·∫∑t tour/ƒë∆∞a ƒë√≥n</li>
                        <li>Chi ti√™u TB d·ªãch v·ª•: 450k/ng√†y</li>
                    </ul>
                </div>
                
                <div style="background: #fff3cd; padding: 20px; border-radius: 10px;">
                    <h4 style="margin: 0 0 15px 0; color: #f39c12;">
                        <i class="fas fa-star"></i> Ph·∫£n H·ªìi & ƒê√°nh Gi√°
                    </h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>ƒêi·ªÉm ƒë√°nh gi√° TB: 4.5/5</li>
                        <li>85% kh√°ch recommend</li>
                        <li>Ph√≤ng s·∫°ch: 4.7/5</li>
                        <li>D·ªãch v·ª•: 4.3/5</li>
                    </ul>
                </div>
            </div>
            
            <!-- Loyalty Program Analysis -->
            <h3 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                <i class="fas fa-gem"></i> Ch∆∞∆°ng Tr√¨nh Kh√°ch H√†ng Th√¢n Thi·∫øt
            </h3>
            
            <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #f1c40f; margin-bottom: 10px;">
                            ${retentionRate}%
                        </div>
                        <div style="color: #666;">T·ª∑ l·ªá gi·ªØ ch√¢n</div>
                    </div>
                    
                    <div style="text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #27ae60; margin-bottom: 10px;">
                            ${vipCustomers}
                        </div>
                        <div style="color: #666;">Th√†nh vi√™n VIP</div>
                    </div>
                    
                    <div style="text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #9b59b6; margin-bottom: 10px;">
                            ${formatCurrency(totalSpending * 0.15)}
                        </div>
                        <div style="color: #666;">Doanh thu t·ª´ VIP</div>
                    </div>
                    
                    <div style="text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #3498db; margin-bottom: 10px;">
                            ${(avgSpending * 1.3).toLocaleString('vi-VN')}ƒë
                        </div>
                        <div style="color: #666;">Chi ti√™u TB VIP</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
                    <h5 style="margin: 0 0 10px 0; color: #2c3e50;">üìä Hi·ªáu Qu·∫£ Ch∆∞∆°ng Tr√¨nh VIP</h5>
                    <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; margin-bottom: 10px;">
                        <div style="width: 75%; height: 100%; background: linear-gradient(to right, #3498db, #9b59b6);"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.9em; color: #666;">
                        <span>Kh√°ch VIP chi·∫øm ${totalCustomers > 0 ? ((vipCustomers / totalCustomers * 100).toFixed(1)) : 0}%</span>
                        <span>ƒê√≥ng g√≥p ${totalSpending > 0 ? (((segments.vip_high + segments.vip_medium) * avgSpending * 1.3 / totalSpending * 100).toFixed(1)) : 0}% doanh thu</span>
                    </div>
                </div>
            </div>
            
            <!-- Strategic Recommendations -->
            <div style="background: #e8f4fc; padding: 25px; border-radius: 10px; border-left: 4px solid #3498db;">
                <h4 style="margin: 0 0 20px 0; color: #2c3e50;">
                    <i class="fas fa-chess-queen"></i> Chi·∫øn L∆∞·ª£c Ph√°t Tri·ªÉn Kh√°ch H√†ng
                </h4>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: #f1c40f;">
                            <i class="fas fa-crown"></i> VIP Program Enhancement
                        </h5>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Tiered membership (Gold/Platinum/Diamond)</li>
                            <li>Personalized welcome amenities</li>
                            <li>Exclusive events & experiences</li>
                            <li>Dedicated relationship manager</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: #27ae60;">
                            <i class="fas fa-retweet"></i> Retention Optimization
                        </h5>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Birthday/anniversary specials</li>
                            <li>Loyalty point redemption</li>
                            <li>Referral program with rewards</li>
                            <li>Win-back campaigns for inactive</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h5 style="margin: 0 0 10px 0; color: #9b59b6;">
                            <i class="fas fa-chart-line"></i> Upsell & Cross-sell
                        </h5>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Room upgrade offers at check-in</li>
                            <li>Dining & spa packages</li>
                            <li>Extended stay discounts</li>
                            <li>Corporate partnership programs</li>
                        </ul>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
                    <h5 style="margin: 0 0 10px 0; color: #2c3e50;">üéØ M·ª•c Ti√™u 6 Th√°ng T·ªõi</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div>
                            <div style="font-weight: bold; color: #3498db;">+15%</div>
                            <div style="font-size: 0.9em; color: #666;">Kh√°ch VIP</div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #27ae60;">+20%</div>
                            <div style="font-size: 0.9em; color: #666;">T·ª∑ l·ªá gi·ªØ ch√¢n</div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #9b59b6;">+25%</div>
                            <div style="font-size: 0.9em; color: #666;">Chi ti√™u TB/kh√°ch</div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #f39c12;">-10%</div>
                            <div style="font-size: 0.9em; color: #666;">Chi ph√≠ acquisition</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef; color: #666; font-size: 0.9em;">
                <p>B√°o c√°o ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông v√†o ${new Date().toLocaleString('vi-VN')}</p>
                <p>D·ª±a tr√™n ph√¢n t√≠ch ${totalCustomers} kh√°ch h√†ng v√† ${managementData.customerHistory.reduce((sum, c) => sum + c.visits, 0)} l∆∞·ª£t thu√™</p>
            </div>
        </div>
    `;
}

// Helper functions for reports
function formatDateRange(start, end) {
    const startDate = new Date(start).toLocaleDateString('vi-VN');
    const endDate = new Date(end).toLocaleDateString('vi-VN');
    return `${startDate} - ${endDate}`;
}

function getFilterName(filter) {
    const filters = {
        'all': 'T·∫•t C·∫£',
        'vip': 'Ch·ªâ VIP',
        'standard': 'Ch·ªâ Standard',
        'suite': 'Ch·ªâ Suite',
        'floor1-3': 'T·∫ßng 1-3',
        'floor4-7': 'T·∫ßng 4-7'
    };
    return filters[filter] || filter;
}

function getDaysBetween(start, end) {
    const startDate = new Date(start);
    const endDate = new Date(end);
    const diffTime = Math.abs(endDate - startDate);
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
}

function isRoomInFilter(room, filter) {
    switch(filter) {
        case 'all': return true;
        case 'vip': return room.type === 'vip';
        case 'standard': return room.type === 'standard';
        case 'suite': return room.type === 'suite';
        case 'floor1-3': return room.floor >= 1 && room.floor <= 3;
        case 'floor4-7': return room.floor >= 4 && room.floor <= 7;
        default: return true;
    }
}

function generateFinancialTrendChart(startDate, endDate) {
    const days = getDaysBetween(startDate, endDate);
    const revenues = Array.from({length: days}, () => Math.random() * 5000000 + 10000000);
    const expenses = revenues.map(rev => rev * (0.3 + Math.random() * 0.2));
    const profits = revenues.map((rev, i) => rev - expenses[i]);
    
    const maxValue = Math.max(...revenues, ...expenses, ...profits);
    
    return `
        <div style="display: flex; height: 100%; align-items: flex-end; gap: 5px;">
            ${Array.from({length: Math.min(days, 30)}).map((_, i) => {
                const revenueHeight = (revenues[i] / maxValue) * 100;
                const expenseHeight = (expenses[i] / maxValue) * 100;
                const profitHeight = (profits[i] / maxValue) * 100;
                
                return `
                    <div style="display: flex; flex-direction: column; align-items: center; flex: 1; height: 100%; justify-content: flex-end;">
                        <div style="width: 80%; display: flex; flex-direction: column; height: 100%;">
                            <div style="height: ${revenueHeight}%; background: #3498db; border-radius: 3px 3px 0 0;"></div>
                            <div style="height: ${expenseHeight}%; background: #e74c3c; margin-top: 2px;"></div>
                            <div style="height: ${profitHeight}%; background: #27ae60; margin-top: 2px; border-radius: 0 0 3px 3px;"></div>
                        </div>
                        <div style="font-size: 0.7em; color: #666; margin-top: 5px;">${i+1}</div>
                    </div>
                `;
            }).join('')}
        </div>
        <div style="position: absolute; bottom: 40px; left: 20px; background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px; font-size: 0.8em;">
            <div><span style="display: inline-block; width: 10px; height: 10px; background: #3498db; margin-right: 5px;"></span> Doanh thu</div>
            <div><span style="display: inline-block; width: 10px; height: 10px; background: #e74c3c; margin-right: 5px;"></span> Chi ph√≠</div>
            <div><span style="display: inline-block; width: 10px; height: 10px; background: #27ae60; margin-right: 5px;"></span> L·ª£i nhu·∫≠n</div>
        </div>
    `;
}

// Other report generation functions (simplified for brevity)
function generateServiceReport(startDate, endDate, filter) {
    return `
        <div class="report-section">
            <div class="report-header">
                <h2 style="margin: 0; color: white;"><i class="fas fa-concierge-bell"></i> B√ÅO C√ÅO D·ªäCH V·ª§</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9;">${formatDateRange(startDate, endDate)} | ${getFilterName(filter)}</p>
            </div>
            <p style="text-align: center; padding: 50px; color: #666;">B√°o c√°o d·ªãch v·ª• ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...</p>
        </div>
    `;
}

function generateStaffReport(startDate, endDate, filter) {
    return `
        <div class="report-section">
            <div class="report-header">
                <h2 style="margin: 0; color: white;"><i class="fas fa-user-tie"></i> B√ÅO C√ÅO NH√ÇN S·ª∞</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9;">${formatDateRange(startDate, endDate)} | ${getFilterName(filter)}</p>
            </div>
            <p style="text-align: center; padding: 50px; color: #666;">B√°o c√°o nh√¢n s·ª± ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...</p>
        </div>
    `;
}

function generateInventoryReport(startDate, endDate, filter) {
    return `
        <div class="report-section">
            <div class="report-header">
                <h2 style="margin: 0; color: white;"><i class="fas fa-boxes"></i> B√ÅO C√ÅO T·ªíN KHO</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9;">${formatDateRange(startDate, endDate)} | ${getFilterName(filter)}</p>
            </div>
            <p style="text-align: center; padding: 50px; color: #666;">B√°o c√°o t·ªìn kho ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...</p>
        </div>
    `;
}

// Report management functions
function loadReportTemplate(templateId) {
    const template = reportTemplates[templateId];
    if (template) {
        document.getElementById('reportTypeSelect').value = template.type === 'daily' ? 'financial' : 
                                                          template.type === 'monthly' ? 'financial' : 
                                                          template.type === 'analysis' ? 'customer' : 
                                                          template.type === 'performance' ? 'occupancy' : 'financial';
        
        document.getElementById('reportPeriodSelect').value = template.type === 'daily' ? 'daily' : 
                                                             template.type === 'monthly' ? 'monthly' : 'monthly';
        
        addNotification(`ƒê√£ t·∫£i m·∫´u "${template.name}"`, 'success');
    }
}

function exportReportToExcel() {
    addNotification('ƒêang xu·∫•t b√°o c√°o sang Excel...', 'info');
    // In a real implementation, this would generate an Excel file
    setTimeout(() => {
        addNotification('Xu·∫•t Excel th√†nh c√¥ng!', 'success');
    }, 1500);
}

function printReport() {
    const reportArea = document.getElementById('reportDisplayArea');
    if (reportArea.style.display !== 'none') {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>In B√°o C√°o</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .report-header { background: #2c3e50; color: white; padding: 20px; margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { padding: 10px; border: 1px solid #ddd; }
                        th { background: #f8f9fa; }
                        @media print {
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${reportArea.innerHTML}
                    <div class="no-print" style="text-align: center; margin-top: 30px;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            In B√°o C√°o
                        </button>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                            ƒê√≥ng
                        </button>
                    </div>
                </body>
            </html>
        `);
        printWindow.document.close();
    } else {
        addNotification('Vui l√≤ng t·∫°o b√°o c√°o tr∆∞·ªõc khi in', 'warning');
    }
}

function saveReportTemplate() {
    const reportType = document.getElementById('reportTypeSelect').value;
    const reportPeriod = document.getElementById('reportPeriodSelect').value;
    const filter = document.getElementById('reportFilterSelect').value;
    
    const templateName = prompt('Nh·∫≠p t√™n cho m·∫´u b√°o c√°o:', 
        `M·∫´u ${reportType} ${reportPeriod} ${filter}`);
    
    if (templateName) {
        const newTemplate = {
            id: 'custom_' + Date.now(),
            name: templateName,
            type: reportType,
            period: reportPeriod,
            filter: filter,
            created: new Date().toISOString()
        };
        
        // In a real implementation, save to localStorage or server
        addNotification(`ƒê√£ l∆∞u m·∫´u "${templateName}"`, 'success');
    }
}

function updateSavedReportsList() {
    const list = document.getElementById('savedReportsList');
    
    if (savedReports.length === 0) {
        list.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-folder-open" style="font-size: 2em; margin-bottom: 10px; display: block;"></i>
                    Ch∆∞a c√≥ b√°o c√°o n√†o ƒë∆∞·ª£c l∆∞u
                </td>
            </tr>
        `;
        return;
    }
    
    list.innerHTML = savedReports.map(report => `
        <tr>
            <td><strong>${report.name}</strong></td>
            <td><span class="status-badge status-active">${report.type}</span></td>
            <td>${report.period}</td>
            <td>${new Date(report.created).toLocaleDateString('vi-VN')}</td>
            <td>${(Math.random() * 2 + 0.5).toFixed(1)} MB</td>
            <td>
                <button class="modal-btn confirm" style="padding: 5px 10px; font-size: 0.8em; margin-right: 5px;" onclick="loadSavedReport('${report.id}')">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="modal-btn confirm" style="padding: 5px 10px; font-size: 0.8em; margin-right: 5px; background: #27ae60;">
                    <i class="fas fa-download"></i>
                </button>
                <button class="modal-btn cancel" style="padding: 5px 10px; font-size: 0.8em;">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');
}

function saveReportToHistory(type, period, date) {
    const report = {
        id: 'report_' + Date.now(),
        name: `B√°o c√°o ${type} ${period} ${date.toLocaleDateString('vi-VN')}`,
        type: type,
        period: period,
        created: date.toISOString(),
        size: (Math.random() * 2 + 0.5).toFixed(1)
    };
    
    savedReports.unshift(report);
    if (savedReports.length > 20) savedReports.pop(); // Keep only last 20
    
    localStorage.setItem('hotel_saved_reports', JSON.stringify(savedReports));
    updateSavedReportsList();
}

// Initialize report management when page loads
window.addEventListener('load', function() {
    initializeReportManagement();
});
