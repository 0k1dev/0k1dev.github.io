<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>ATC 2D â€“ Full Tower Simulation</title>
<style>
body{margin:0;font-family:Arial;background:#020617;color:#e5e7eb}
#layout{display:flex;height:100vh}
#game{flex:1;background:#020617}
#ui{width:320px;background:#020617;border-left:2px solid #1f2937;display:flex;flex-direction:column}
.panel{flex:1;border-bottom:1px solid #1f2937;padding:6px}
.panel h3{margin:4px 0;font-size:14px;text-align:center}
.list{border:1px dashed #374151;min-height:80px;padding:4px}
.item{background:#1f2937;margin:4px;padding:4px;font-size:12px;border-radius:4px;cursor:grab}
#msg{height:48px;border-top:2px solid #1f2937;display:flex;align-items:center;justify-content:center;font-size:14px}
</style>
</head>
<body>
<div id="layout">
<canvas id="game" width="1200" height="700"></canvas>
<div id="ui">
 <div class="panel"><h3>AIR</h3><div id="air" class="list"></div></div>
 <div class="panel"><h3>LAND</h3><div id="landing" class="list"></div></div>
 <div class="panel"><h3>PARK</h3><div id="parked" class="list"></div></div>
 <div class="panel"><h3>DEP</h3><div id="takeoff" class="list"></div></div>
 <div id="msg">ATC READY</div>
</div>
</div>
<script>
// ================= CANVAS =================
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const msgBox=document.getElementById('msg');

// ================= MAP DATA =================
const runway={id:'10',x:300,y:260,w:700,h:50};
const runwayR={id:'10R',x:300,y:340,w:700,h:50};
const taxi={x:200,y:420,w:600,h:30};
const apron={x:50,y:460,w:250,h:200};
const gates=[];
for(let i=0;i<30;i++){
 gates.push({id:i+1,x:60+(i%6)*40,y:470+Math.floor(i/6)*40,w:30,h:30});
}
const holding={x:180,y:150,r:70};

// ================= AIRCRAFT =================
class Aircraft{
 constructor(id){
  this.id=id;this.x=holding.x;this.y=holding.y;this.state='air';this.target=null;this.speed=1.4;this.clear=false;
 }
 setTarget(t){this.target={x:t.x+t.w/2,y:t.y+t.h/2}}
 update(){
  if(this.target){
   const dx=this.target.x-this.x,dy=this.target.y-this.y;
   const d=Math.hypot(dx,dy);
   if(d>1){this.x+=dx/d*this.speed;this.y+=dy/d*this.speed}else this.target=null;
  }
 }
 draw(){
  ctx.fillStyle=this.clear?'#22c55e':'#facc15';
  ctx.beginPath();ctx.arc(this.x,this.y,7,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#fff';ctx.fillText(this.id,this.x-10,this.y-10);
 }
}

let planes=[new Aircraft('VN101'),new Aircraft('VN202')];

// ================= ATC LOGIC =================
let clearance=null;
function issue(type,plane,gate){
 clearance={type,plane,gate};
 msgBox.textContent=`ATC: ${plane.id} CLEARED ${type.toUpperCase()} RWY 10 GATE ${gate}`;
 msgBox.style.color='#22c55e';
 plane.clear=true;
 if(type==='landing')plane.setTarget(runway);
 if(type==='park')plane.setTarget(gates[gate-1]);
 if(type==='takeoff')plane.setTarget(taxi);
}

// ================= DRAW MAP =================
function drawMap(){
 ctx.fillStyle='#020617';ctx.fillRect(0,0,canvas.width,canvas.height);
 ctx.strokeStyle='#38bdf8';ctx.setLineDash([6,6]);ctx.beginPath();ctx.arc(holding.x,holding.y,holding.r,0,Math.PI*2);ctx.stroke();ctx.setLineDash([]);
 ctx.fillText('HOLD',holding.x-20,holding.y-holding.r-5);
 ctx.fillStyle='#334155';ctx.fillRect(runway.x,runway.y,runway.w,runway.h);ctx.fillRect(runwayR.x,runwayR.y,runwayR.w,runwayR.h);
 ctx.fillStyle='#fff';ctx.fillText('RWY 10',runway.x+10,runway.y+32);ctx.fillText('RWY 10R',runwayR.x+10,runwayR.y+32);
 ctx.fillStyle='#475569';ctx.fillRect(taxi.x,taxi.y,taxi.w,taxi.h);ctx.fillText('TAXI',taxi.x+10,taxi.y+22);
 ctx.fillStyle='#064e3b';ctx.fillRect(apron.x,apron.y,apron.w,apron.h);ctx.fillStyle='#a7f3d0';ctx.fillText('APRON',apron.x+10,apron.y+20);
 ctx.fillStyle='#16a34a';gates.forEach(g=>ctx.fillRect(g.x,g.y,g.w,g.h));
}

// ================= LOOP =================
function loop(){drawMap();planes.forEach(p=>{p.update();p.draw()});requestAnimationFrame(loop)}loop();

// ================= UI =================
const panels={air,landing,parked,takeoff};
function refresh(){Object.values(panels).forEach(p=>p.innerHTML='');planes.forEach(pl=>{const d=document.createElement('div');d.className='item';d.textContent=pl.id;d.draggable=true;d.ondragstart=e=>e.dataTransfer.setData('id',pl.id);panels[pl.state].appendChild(d)})}
refresh();
Object.entries(panels).forEach(([state,el])=>{el.ondragover=e=>e.preventDefault();el.ondrop=e=>{const id=e.dataTransfer.getData('id');const p=planes.find(x=>x.id===id);p.state=state;if(state==='landing')issue('landing',p,1);if(state==='parked')issue('park',p,Math.floor(Math.random()*30)+1);if(state==='takeoff')issue('takeoff',p,0);refresh()}});
</script>
</body>
</html>
