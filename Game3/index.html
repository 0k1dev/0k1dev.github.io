<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game C√¥ng Th√†nh T·ª± ƒê·ªông H√≥a</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ò†Ô∏è</text></svg>">
    <style>
        /* --- CSS (Kh√¥ng ƒë·ªïi so v·ªõi phi√™n b·∫£n tr∆∞·ªõc, ch·ªâ gi·ªØ l·∫°i ƒë·ªÉ ch·∫°y) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f7f6;
            margin: 0;
            color: #333;
        }

        .game-container {
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background-color: #fff;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            width: 95%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        /* --- V√ôNG B·∫¢N ƒê·ªí (MAP) --- */
        .game-map {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            width: 800px;
            height: 400px;
            border: 5px solid #333;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .territory {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 1px solid #333;
            cursor: pointer;
            transition: opacity 0.3s, transform 0.1s;
            font-weight: bold;
        }

        .territory:hover:not(.disabled) {
            transform: scale(1.02);
            z-index: 10;
        }
        
        /* M√†u s·∫Øc l√£nh th·ªï */
        .team-1 { background-color: #e74c3c; color: white; } /* Red - Player */
        .team-2 { background-color: #3498db; color: white; } /* Blue */
        .team-3 { background-color: #2ecc71; color: #333; } /* Green */
        .team-4 { background-color: #f1c40f; color: #333; } /* Yellow */
        .team-5 { background-color: #9b59b6; color: white; } /* Purple */
        .team-6 { background-color: #1abc9c; color: #333; } /* Turquoise */
        .team-7 { background-color: #e67e22; color: white; } /* Orange */
        .team-8 { background-color: #34495e; color: white; } /* Dark Blue */

        .disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .army-display {
            font-size: 1.5em;
            margin-top: 5px;
        }
        
        .owner-display {
             font-size: 1.1em;
             margin-bottom: 5px;
        }

        /* --- B·∫¢NG TH√îNG TIN --- */
        .status-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            width: 100%;
        }
        .team-status-mini {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            width: 20%;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .team-status-mini p {
            margin: 2px 0;
            font-weight: 600;
        }
        .team-status-mini span {
            font-weight: bold;
            color: #27ae60;
        }
        
        .message {
            margin-top: 25px;
            padding: 15px;
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            font-weight: bold;
            color: #333;
            text-align: center;
            width: 90%;
        }
        
        .current-player {
            font-size: 1.3em;
            color: #c0392b;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 5px;
            border: 1px dashed #c0392b;
        }
        .auto-battle-log {
            font-size: 0.9em;
            color: #2c3e50;
            max-height: 100px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
            margin-top: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>‚öîÔ∏è Tr·∫≠n Chi·∫øn C√¥ng Th√†nh T·ª± ƒê·ªông H√≥a ‚öîÔ∏è</h1>
        
        <div class="current-player">
            Ng∆∞·ªùi ch∆°i (B·∫°n): <span id="current-player-name">ƒê·ªôi 1 (RED)</span>
            <p style="font-size: 0.7em; font-weight: normal; margin: 5px 0 0;">(Click v√†o v√πng l√£nh th·ªï kh√°c ƒë·ªÉ t·∫•n c√¥ng)</p>
        </div>

        <div id="game-map" class="game-map">
            </div>

        <div id="message" class="message">Click v√†o v√πng l√£nh th·ªï ƒë·ªãch ƒë·ªÉ t·∫•n c√¥ng. C·∫ßn 50 qu√¢n ƒë·ªÉ t·∫•n c√¥ng.</div>
        
        <div id="auto-battle-log" class="auto-battle-log">Log chi·∫øn ƒë·∫•u t·ª± ƒë·ªông:</div>

        <h2 style="margin-top: 30px; border-bottom: 1px solid #eee; padding-bottom: 5px;">B·∫£ng Tr·∫°ng Th√°i Qu√¢n L√≠nh</h2>
        <div id="status-panel-container" class="status-panel">
            </div>
    </div>

    <script>
        // --- JavaScript ---

        // --- C·∫•u h√¨nh Game ---
        const NUM_TEAMS = 8;
        const INITIAL_ARMY = 0; // Qu√¢n kh·ªüi ƒë·∫ßu l√† 0
        const PRODUCTION_RATE = 5; // S·ªë qu√¢n s·∫£n xu·∫•t m·ªói gi√¢y
        const ATTACK_COST = 50; // Qu√¢n c·∫ßn ƒë·ªÉ ph√°t ƒë·ªông t·∫•n c√¥ng
        const ATTACK_POWER = 60; // Qu√¢n b·ªã ti√™u di·ªát khi t·∫•n c√¥ng th√†nh c√¥ng
        const CURRENT_PLAYER_ID = 1; // ID c·ªßa ng∆∞·ªùi ch∆°i (B·∫°n)
        const AUTO_ATTACK_INTERVAL = 3000; // T·∫ßn su·∫•t t·ª± ƒë·ªông t·∫•n c√¥ng (3 gi√¢y)

        let teams = {};
        let teamColors = ["#e74c3c", "#3498db", "#2ecc71", "#f1c40f", "#9b59b6", "#1abc9c", "#e67e22", "#34495e"];
        let teamNames = ["RED", "BLUE", "GREEN", "YELLOW", "PURPLE", "TURQUOISE", "ORANGE", "DARK"];
        let teamClasses = ["team-1", "team-2", "team-3", "team-4", "team-5", "team-6", "team-7", "team-8"];
        let gameRunning = true;

        /**
         * Kh·ªüi t·∫°o d·ªØ li·ªáu cho 8 ƒë·ªôi.
         */
        function initializeTeams() {
            for (let i = 1; i <= NUM_TEAMS; i++) {
                teams[i] = {
                    army: INITIAL_ARMY,
                    production: PRODUCTION_RATE,
                    name: `ƒê·ªôi ${i} (${teamNames[i-1]})`,
                    class: teamClasses[i-1],
                    color: teamColors[i-1]
                };
            }
        }

        /**
         * T·∫°o v√† ch√®n HTML cho b·∫£n ƒë·ªì v√† b·∫£ng tr·∫°ng th√°i. (Kh√¥ng thay ƒë·ªïi)
         */
        function createMapAndStatus() {
            const mapContainer = document.getElementById('game-map');
            const statusContainer = document.getElementById('status-panel-container');
            let mapHTML = '';
            let statusHTML = '';

            for (let i = 1; i <= NUM_TEAMS; i++) {
                // T·∫°o l√£nh th·ªï tr√™n b·∫£n ƒë·ªì
                mapHTML += `
                    <div id="territory-${i}" class="territory ${teams[i].class}" onclick="handleMapClick(${i})">
                        <div class="owner-display">${teams[i].name}</div>
                        <div id="army-map-${i}" class="army-display">${teams[i].army}</div>
                    </div>
                `;

                // T·∫°o th·∫ª tr·∫°ng th√°i mini
                statusHTML += `
                    <div id="status-mini-${i}" class="team-status-mini ${teams[i].class}">
                        <p>${teams[i].name}</p>
                        <p>Qu√¢n: <span id="army-status-${i}">${teams[i].army}</span></p>
                    </div>
                `;
            }
            mapContainer.innerHTML = mapHTML;
            statusContainer.innerHTML = statusHTML;
        }

        /**
         * C·∫≠p nh·∫≠t giao di·ªán (Map v√† Status Panel)
         */
        function updateUI() {
            for (const teamId in teams) {
                const army = Math.floor(Math.max(0, teams[teamId].army));
                const territoryEl = document.getElementById(`territory-${teamId}`);
                const statusEl = document.getElementById(`status-mini-${teamId}`);

                // C·∫≠p nh·∫≠t qu√¢n s·ªë tr√™n b·∫£n ƒë·ªì v√† b·∫£ng tr·∫°ng th√°i
                document.getElementById(`army-map-${teamId}`).textContent = army;
                document.getElementById(`army-status-${teamId}`).textContent = army;

                // X·ª≠ l√Ω ƒë·ªôi b·ªã ti√™u di·ªát
                if (army <= 0 && territoryEl) {
                    territoryEl.classList.add('disabled');
                    statusEl.classList.add('disabled');
                    territoryEl.onclick = null; // V√¥ hi·ªáu h√≥a click
                    
                    // ƒê·∫£m b·∫£o kh√¥ng s·∫£n xu·∫•t qu√¢n n·ªØa
                    teams[teamId].production = 0; 
                } else if (territoryEl) {
                    territoryEl.classList.remove('disabled');
                    // Ch·ªâ ƒê·ªôi 1 m·ªõi c√≥ th·ªÉ click t·∫•n c√¥ng
                    if (parseInt(teamId) === CURRENT_PLAYER_ID) {
                        territoryEl.onclick = () => handleMapClick(parseInt(teamId)); 
                    } else {
                        territoryEl.onclick = () => handleMapClick(parseInt(teamId)); 
                    }
                }
            }
        }

        /**
         * X·ª≠ l√Ω s·ª± ki·ªán click v√†o l√£nh th·ªï (Ch·ªâ d√†nh cho ƒê·ªôi 1)
         * @param {number} targetId - ID c·ªßa ƒë·ªôi b·ªã t·∫•n c√¥ng (l√£nh th·ªï ƒë∆∞·ª£c click).
         */
        function handleMapClick(targetId) {
            if (!gameRunning) return;

            const attackerId = CURRENT_PLAYER_ID; 
            
            if (attackerId === targetId) {
                document.getElementById('message').textContent = `‚ö†Ô∏è Kh√¥ng th·ªÉ t·∫•n c√¥ng l√£nh th·ªï c·ªßa ch√≠nh m√¨nh (${teams[targetId].name}).`;
                return;
            }
            
            // ƒê·∫£m b·∫£o m·ª•c ti√™u v·∫´n c√≤n qu√¢n
            if (teams[targetId].army <= 0) {
                 document.getElementById('message').textContent = `‚ö†Ô∏è L√£nh th·ªï ${teams[targetId].name} ƒë√£ b·ªã ti√™u di·ªát!`;
                 return;
            }

            // T·∫•n c√¥ng b·∫±ng tay (ƒê·ªôi 1)
            attack(attackerId, targetId, document.getElementById('message'));
        }

        /**
         * Th√™m th√¥ng b√°o v√†o log t·ª± ƒë·ªông.
         */
        function addToLog(message) {
            const log = document.getElementById('auto-battle-log');
            const now = new Date().toLocaleTimeString();
            log.innerHTML = `[${now}] ${message}<br>` + log.innerHTML;
            // Gi·ªõi h·∫°n log ƒë·ªÉ tr√°nh qu√° t·∫£i
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }

        /**
         * H√†m x·ª≠ l√Ω logic t·∫•n c√¥ng chung.
         * @param {number} attackerId - ID c·ªßa ƒë·ªôi t·∫•n c√¥ng.
         * @param {number} targetId - ID c·ªßa ƒë·ªôi b·ªã t·∫•n c√¥ng.
         * @param {HTMLElement} [outputEl] - Element ƒë·ªÉ hi·ªÉn th·ªã tin nh·∫Øn (d√†nh cho ng∆∞·ªùi ch∆°i).
         */
        function attack(attackerId, targetId, outputEl) {
            const attacker = teams[attackerId];
            const target = teams[targetId];

            if (attacker.army >= ATTACK_COST) {
                // 1. Tr·ª´ qu√¢n ph√≠ t·ªïn cho ƒë·ªôi t·∫•n c√¥ng
                attacker.army -= ATTACK_COST;

                // 2. M√¥ ph·ªèng tr·∫≠n chi·∫øn: ƒë·ªôi b·ªã t·∫•n c√¥ng m·∫•t qu√¢n
                target.army -= ATTACK_POWER;

                const message = `üí• ${attacker.name} ƒë√£ d√πng ${ATTACK_COST} qu√¢n T·∫§N C√îNG ${target.name}. ${target.name} m·∫•t ${ATTACK_POWER} qu√¢n!`;
                
                if (outputEl) {
                    // Th√¥ng b√°o cho ng∆∞·ªùi ch∆°i (ƒê·ªôi 1)
                    outputEl.textContent = message;
                } else {
                    // Log tr·∫≠n chi·∫øn t·ª± ƒë·ªông
                    addToLog(message);
                }

                // 3. Ki·ªÉm tra ƒëi·ªÅu ki·ªán th·∫Øng/thua
                if (target.army <= 0) {
                    target.army = 0;
                    
                    // L√£nh th·ªï b·ªã chi·∫øm (ƒë·ªïi m√†u)
                    const targetTerritoryEl = document.getElementById(`territory-${targetId}`);
                    targetTerritoryEl.classList.remove(target.class); 
                    targetTerritoryEl.classList.add(attacker.class);  
                    
                    target.class = attacker.class; 
                    target.color = attacker.color;
                    target.name = `${target.name} (B·ªä CHI·∫æM b·ªüi ${attacker.name})`; 

                    const conquestMessage = `üéâ ${attacker.name} ƒë√£ CHI·∫æM ƒë∆∞·ª£c l√£nh th·ªï c·ªßa ${target.name}! üéâ`;
                    if (outputEl) {
                        outputEl.textContent = conquestMessage;
                    } else {
                        addToLog(conquestMessage);
                    }

                    checkGameOver();
                }

            } else if (outputEl) {
                // Ch·ªâ th√¥ng b√°o thi·∫øu qu√¢n cho ng∆∞·ªùi ch∆°i (ƒê·ªôi 1)
                outputEl.textContent = `‚ö†Ô∏è ${attacker.name}: Kh√¥ng ƒë·ªß qu√¢n (${Math.floor(attacker.army)}) ƒë·ªÉ t·∫•n c√¥ng. C·∫ßn ${ATTACK_COST} qu√¢n.`;
            }

            updateUI();
        }

        /**
         * S·∫£n xu·∫•t qu√¢n m·ªói gi√¢y.
         */
        function produceArmy() {
            if (!gameRunning) return;

            for (const teamId in teams) {
                teams[teamId].army += teams[teamId].production;
            }
            updateUI();
        }

        /**
         * Logic cho c√°c ƒë·ªôi m√°y (ƒê·ªôi 2 ƒë·∫øn ƒê·ªôi 8) t·ª± ƒë·ªông t·∫•n c√¥ng.
         */
        function autoAttack() {
            if (!gameRunning) return;

            for (let attackerId = 2; attackerId <= NUM_TEAMS; attackerId++) {
                const attacker = teams[attackerId];

                // Ki·ªÉm tra ƒë·ªôi c√≤n qu√¢n kh√¥ng v√† ƒë·ªß chi ph√≠ kh√¥ng
                if (attacker.army <= 0 || attacker.army < ATTACK_COST) {
                    continue;
                }

                // T√¨m t·∫•t c·∫£ c√°c m·ª•c ti√™u c√≤n s·ªëng (c√≤n qu√¢n > 0)
                let availableTargets = [];
                for (let targetId = 1; targetId <= NUM_TEAMS; targetId++) {
                    if (targetId !== attackerId && teams[targetId].army > 0) {
                        availableTargets.push(targetId);
                    }
                }

                if (availableTargets.length > 0) {
                    // Ch·ªçn m·ª•c ti√™u ng·∫´u nhi√™n
                    const randomIndex = Math.floor(Math.random() * availableTargets.length);
                    const targetId = availableTargets[randomIndex];
                    
                    // Th·ª±c hi·ªán t·∫•n c√¥ng
                    attack(attackerId, targetId);
                }
            }
        }

        /**
         * Ki·ªÉm tra ƒëi·ªÅu ki·ªán k·∫øt th√∫c game.
         */
        function checkGameOver() {
            let activeTeams = 0;
            let lastActiveTeamId = null;

            for (const id in teams) {
                if (teams[id].army > 0) {
                    activeTeams++;
                    lastActiveTeamId = parseInt(id);
                }
            }

            if (activeTeams <= 1) {
                gameRunning = false;
                clearInterval(gameInterval); 
                clearInterval(autoAttackInterval);
                const messageEl = document.getElementById('message');

                if (lastActiveTeamId) {
                    messageEl.className = 'message team-3'; 
                    messageEl.textContent = `üëë TR·∫¨N CHI·∫æN K·∫æT TH√öC! ${teams[lastActiveTeamId].name} l√† ng∆∞·ªùi chi·∫øn th·∫Øng cu·ªëi c√πng! üëë`;
                } else {
                    messageEl.textContent = `Tr·∫≠n chi·∫øn k·∫øt th√∫c trong h·ªón lo·∫°n (T·∫•t c·∫£ c√°c ƒë·ªôi ƒë·ªÅu b·ªã ti√™u di·ªát!)`;
                }
            }
        }


        // --- Kh·ªüi ƒë·ªông Game ---
        initializeTeams();
        createMapAndStatus();
        document.getElementById('current-player-name').textContent = teams[CURRENT_PLAYER_ID].name;
        
        // Thi·∫øt l·∫≠p chu k·ª≥ s·∫£n xu·∫•t qu√¢n m·ªói 1000ms (1 gi√¢y)
        const gameInterval = setInterval(produceArmy, 1000);
        
        // Thi·∫øt l·∫≠p chu k·ª≥ t·ª± ƒë·ªông t·∫•n c√¥ng cho c√°c ƒë·ªôi m√°y
        const autoAttackInterval = setInterval(autoAttack, AUTO_ATTACK_INTERVAL);

        // Kh·ªüi t·∫°o giao di·ªán
        updateUI();
    </script>
</body>
</html>
