<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Carom 3 BÄƒng â€“ Pro Training</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;background:#0b0b0b;color:#fff;
  font-family:Arial;display:flex;
  flex-direction:column;align-items:center
}
h1{color:#00e5ff;margin:8px}
canvas{
  background:#145214;
  border:18px solid #5b2c06;
  border-radius:12px;
}
.info{margin-top:6px;font-size:14px;color:#ccc}
/* QR BOX */
#qr-box{
  position: absolute;
  top: 10px;
  right: -160px; /* Ä‘áº©y ra ngoÃ i bÃ n */
  width: 150px;
  text-align: center;
}

#qr-box img{
  width: 140px;
  border-radius: 10px;
  background:#fff;
  padding:5px;
}

.qr-text{
  margin-top:6px;
  font-size:13px;
  color:#ccc;
}
</style>
</head>

<body>
<h1>ðŸŽ± Carom 3 BÄƒng â€“ Pro Training</h1>
<canvas id="c" width="900" height="450"></canvas>
<div class="info" id="info">
  Click bi tráº¯ng â†’ SPACE láº¥y lá»±c | A/D xoÃ¡y | S = khÃ´ng xoÃ¡y
</div>
<div id="qr-box">
    <img id="vietqr" alt="QR Donate">
    <div class="qr-text">á»¦ng há»™ tÃ¡c giáº£</div>
</div>
<script>
/* ======== BANK =======*/
const BANK_ID = "ACB";          // hoáº·c 970416
const ACCOUNT_NO = "43146717";
const ACCOUNT_NAME = "DINH TAN HUY";

document.getElementById("vietqr").src =
  `https://img.vietqr.io/image/${BANK_ID}-${ACCOUNT_NO}-compact2.png` +
  `?addInfo=Donate+Carom+3+Bang` +
  `&accountName=${encodeURIComponent(ACCOUNT_NAME)}`;
/*===================*/

  
const canvas=c=document.getElementById("c");
const ctx=c.getContext("2d");
c.addEventListener("contextmenu",e=>e.preventDefault());

const R=10;
const FRICTION=0.992;
const MAX_POWER=120;

/* ===== BALL ===== */
class Ball{
  constructor(x,y,color){
    this.x=x;this.y=y;
    this.vx=0;this.vy=0;
    this.color=color;
  }
}
let white=new Ball(150,225,"#fff");
let red=new Ball(450,160,"red");
let yellow=new Ball(600,290,"yellow");
const balls=[white,red,yellow];

/* ===== STATE ===== */
let aiming=false, showCue=false;
let aimX=0, aimY=0;
let power=0, charging=false;
let spin=0; // -1 left | 0 none | 1 right

/* ===== DRAW TABLE DOTS ===== */
function drawDots(){
  ctx.fillStyle="#cfa";
  const d=c.width/8;
  for(let i=1;i<8;i++){
    ctx.beginPath();ctx.arc(i*d,8,3,0,6.28);ctx.fill();
    ctx.beginPath();ctx.arc(i*d,c.height-8,3,0,6.28);ctx.fill();
  }
}

/* ===== DRAW ===== */
function drawBall(b){
  ctx.beginPath();
  ctx.arc(b.x,b.y,R,0,6.28);
  ctx.fillStyle=b.color;
  ctx.fill();
}

/* ===== PREDICTION LINE ===== */
function drawPredict(){
  if(!showCue) return;
  let x=white.x,y=white.y;
  let dx=aimX-white.x, dy=aimY-white.y;
  let len=Math.hypot(dx,dy)||1;
  dx/=len; dy/=len;

  ctx.setLineDash([6,6]);
  ctx.strokeStyle="rgba(255,255,255,.6)";
  ctx.beginPath();
  ctx.moveTo(x,y);

  for(let i=0;i<3;i++){
    let tX = dx>0 ? (c.width-R-x)/dx : (R-x)/dx;
    let tY = dy>0 ? (c.height-R-y)/dy : (R-y)/dy;
    let t = Math.min(tX,tY);
    x+=dx*t; y+=dy*t;
    ctx.lineTo(x,y);
    if(tX<tY) dx*=-1; else dy*=-1;
  }
  ctx.stroke();
  ctx.setLineDash([]);
}

/* ===== CUE ===== */
function drawCue(){
  if(!showCue) return;
  let dx=aimX-white.x, dy=aimY-white.y;
  let ang=Math.atan2(dy,dx);
  ctx.save();
  ctx.translate(white.x,white.y);
  ctx.rotate(ang);
  ctx.fillStyle="#deb887";
  ctx.fillRect(-40-power*0.6,-2,200,4);
  ctx.restore();
}

/* ===== BALL COLLISION (ELASTIC) ===== */
function collide(a,b){
  const dx=b.x-a.x, dy=b.y-a.y;
  const dist=Math.hypot(dx,dy);
  if(dist>=2*R||dist===0) return;
  const nx=dx/dist, ny=dy/dist;
  const tx=-ny, ty=nx;

  const dpTanA=a.vx*tx+a.vy*ty;
  const dpTanB=b.vx*tx+b.vy*ty;
  const dpNormA=a.vx*nx+a.vy*ny;
  const dpNormB=b.vx*nx+b.vy*ny;

  a.vx=tx*dpTanA+nx*dpNormB;
  a.vy=ty*dpTanA+ny*dpNormB;
  b.vx=tx*dpTanB+nx*dpNormA;
  b.vy=ty*dpTanB+ny*dpNormA;

  const overlap=2*R-dist;
  a.x-=nx*overlap/2; a.y-=ny*overlap/2;
  b.x+=nx*overlap/2; b.y+=ny*overlap/2;
}

/* ===== UPDATE ===== */
function update(){
  ctx.clearRect(0,0,c.width,c.height);
  drawDots();

  balls.forEach(b=>{
    b.x+=b.vx; b.y+=b.vy;
    b.vx*=FRICTION; b.vy*=FRICTION;
    if(Math.hypot(b.vx,b.vy)<0.02){b.vx=b.vy=0;}

    if(b.x<R||b.x>c.width-R){
      b.vx*=-1;
      if(b===white) b.vy+=spin*0.15;
    }
    if(b.y<R||b.y>c.height-R){
      b.vy*=-1;
      if(b===white) b.vx-=spin*0.15;
    }
  });

  collide(white,red);
  collide(white,yellow);
  collide(red,yellow);

  balls.forEach(drawBall);
  drawPredict();
  drawCue();
  requestAnimationFrame(update);
}

/* ===== INPUT ===== */
canvas.addEventListener("mousedown",e=>{
  if(e.button!==0||white.vx||white.vy) return;
  const r=c.getBoundingClientRect();
  const x=e.clientX-r.left, y=e.clientY-r.top;
  if(Math.hypot(x-white.x,y-white.y)<R+5){
    showCue=aiming=true;
    aimX=x; aimY=y;
  }
});
canvas.addEventListener("mousemove",e=>{
  if(!aiming) return;
  const r=c.getBoundingClientRect();
  aimX=e.clientX-r.left;
  aimY=e.clientY-r.top;
});
window.addEventListener("keydown",e=>{
  if(e.code==="Space"&&showCue) charging=true;
  if(e.key==="a") spin=-1;
  if(e.key==="d") spin=1;
  if(e.key==="s") spin=0;
});
window.addEventListener("keyup",e=>{
  if(e.code==="Space"&&showCue){
    let dx=aimX-white.x, dy=aimY-white.y;
    let len=Math.hypot(dx,dy)||1;
    let force=Math.min(power*0.15,8);
    white.vx=(dx/len)*force;
    white.vy=(dy/len)*force;
    charging=showCue=aiming=false;
    power=0;
  }
});
setInterval(()=>{
  if(charging) power=Math.min(power+3,MAX_POWER);
},30);

update();
</script>
</body>
</html>
