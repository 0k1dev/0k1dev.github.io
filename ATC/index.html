<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>ATC 2D – Prototype</title>
<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:Arial}
#ui{display:flex;gap:10px;padding:10px}
.panel{background:#151515;border:1px solid #333;border-radius:6px;padding:8px;width:200px}
.panel h3{margin:0 0 6px;font-size:14px;text-align:center}
.list{min-height:120px;border:1px dashed #444;padding:4px}
#game{display:block;margin:10px auto;border:1px solid #333;background:#0f172a}
.item{background:#1f2937;margin:4px;padding:4px;font-size:12px;cursor:grab}
</style>
</head>
<body>
<div id="ui">
  <div class="panel"><h3>Chờ trên không</h3><div id="air" class="list"></div></div>
  <div class="panel"><h3>Đang đỗ</h3><div id="parked" class="list"></div></div>
  <div class="panel"><h3>Cất cánh</h3><div id="takeoff" class="list"></div></div>
  <div class="panel"><h3>Hạ cánh</h3><div id="landing" class="list"></div></div>
</div>
<canvas id="game" width="1000" height="600"></canvas>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');

// ====== MAP ======
const runways=[
 {id:'10',x:650,y:120,w:300,h:40},
 {id:'10R',x:650,y:200,w:300,h:40}
];
const taxiLane={x:300,y:300,w:350,h:30};
const stands=[];
for(let i=0;i<30;i++)stands.push({id:i,x:50+(i%10)*60,y:350+Math.floor(i/10)*60,w:40,h:40});

// ====== PLANES ======
let planes=[];
for(let i=0;i<5;i++)planes.push({id:'VN'+(100+i),x:100,y:80+i*30,state:'air',target:null});

function drawMap(){
 ctx.fillStyle='#1e293b';
 ctx.fillRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle='#374151';
 runways.forEach(r=>ctx.fillRect(r.x,r.y,r.w,r.h));
 ctx.fillRect(taxiLane.x,taxiLane.y,taxiLane.w,taxiLane.h);
 ctx.fillStyle='#065f46';
 stands.forEach(s=>ctx.fillRect(s.x,s.y,s.w,s.h));
}

function drawPlanes(){
 planes.forEach(p=>{
  ctx.fillStyle=p.state==='air'?'#38bdf8':'#facc15';
  ctx.beginPath();ctx.arc(p.x,p.y,8,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#fff';ctx.fillText(p.id,p.x-10,p.y-12);
 });
}

function update(){
 planes.forEach(p=>{
  if(p.target){
   const dx=p.target.x-p.x;const dy=p.target.y-p.y;
   const d=Math.hypot(dx,dy);
   if(d>1){p.x+=dx/d;p.y+=dy/d}else p.target=null;
  }
 });
}

function loop(){
 drawMap();update();drawPlanes();requestAnimationFrame(loop);
}
loop();

// ====== UI ======
const panels={air,parked,takeoff,landing};
function refresh(){Object.values(panels).forEach(p=>p.innerHTML='');
 planes.forEach(pl=>{
  const div=document.createElement('div');
  div.className='item';div.textContent=pl.id;
  div.draggable=true;
  div.ondragstart=e=>e.dataTransfer.setData('id',pl.id);
  panels[pl.state].appendChild(div);
 });}
refresh();

Object.entries(panels).forEach(([state,el])=>{
 el.ondragover=e=>e.preventDefault();
 el.ondrop=e=>{
  const id=e.dataTransfer.getData('id');
  const p=planes.find(x=>x.id===id);
  p.state=state;
  if(state==='landing')p.target=runways[0];
  if(state==='parked')p.target=stands[Math.floor(Math.random()*stands.length)];
  if(state==='takeoff')p.target=taxiLane;
  refresh();
 };
});
</script>
</body>
</html>
