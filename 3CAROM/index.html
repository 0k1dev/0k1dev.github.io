<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Carom 3 BÄƒng â€“ Training Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}
h1{color:#00e5ff;margin:10px}
canvas{
  background:#145214;
  border:18px solid #5b2c06;
  border-radius:12px;
}
#powerBox{
  width:300px;height:12px;
  background:#333;margin-top:10px;
  border-radius:6px;overflow:hidden;
}
#power{
  height:100%;width:0%;
  background:linear-gradient(90deg,#00ffcc,#ff0044);
}
.info{margin-top:8px;font-size:15px}
</style>
</head>

<body>

<h1>ðŸŽ± Carom 3 BÄƒng â€“ Training Pro</h1>
<canvas id="table" width="900" height="450"></canvas>
<div id="powerBox"><div id="power"></div></div>
<div class="info" id="info">
  Click bi tráº¯ng Ä‘á»ƒ Ä‘áº·t gáº­y â€“ giá»¯ SPACE Ä‘á»ƒ láº¥y lá»±c
</div>

<script>
const canvas=document.getElementById("table");
const ctx=canvas.getContext("2d");
const powerBar=document.getElementById("power");
const info=document.getElementById("info");

const R=10;
const MAX_POWER=100;
const FRICTION=0.985;

/* ===== BALL ===== */
class Ball{
  constructor(x,y,color){
    this.x=x;this.y=y;
    this.vx=0;this.vy=0;
    this.color=color;
  }
}
let white=new Ball(150,225,"#fff");
let red=new Ball(450,180,"red");
let yellow=new Ball(600,270,"yellow");
const balls=[white,red,yellow];

/* ===== STATE ===== */
let showCue=false;
let aiming=false;
let aimX=0, aimY=0;
let power=0;
let charging=false;

/* ===== TABLE DOTS ===== */
function drawTable(){
  ctx.fillStyle="#cfa";
  const d=canvas.width/8;
  for(let i=1;i<8;i++){
    ctx.beginPath();ctx.arc(i*d,8,3,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.arc(i*d,canvas.height-8,3,0,Math.PI*2);ctx.fill();
  }
  for(let i=1;i<4;i++){
    ctx.beginPath();ctx.arc(8,i*(canvas.height/4),3,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.arc(canvas.width-8,i*(canvas.height/4),3,0,Math.PI*2);ctx.fill();
  }
}

/* ===== DRAW ===== */
function drawBall(b){
  ctx.beginPath();
  ctx.arc(b.x,b.y,R,0,Math.PI*2);
  ctx.fillStyle=b.color;
  ctx.fill();
}

/* ===== CUE ===== */
function drawCue(){
  if(!showCue) return;
  let dx=white.x-aimX;
  let dy=white.y-aimY;
  let ang=Math.atan2(dy,dx);
  let back=30+power*0.6;

  ctx.save();
  ctx.translate(white.x,white.y);
  ctx.rotate(ang);
  ctx.fillStyle="#deb887";
  ctx.fillRect(back,-2,200,4);
  ctx.restore();
}

/* ===== COLLISION BALL-BALL ===== */
function ballCollision(a,b){
  let dx=b.x-a.x;
  let dy=b.y-a.y;
  let dist=Math.hypot(dx,dy);
  if(dist<2*R){
    let angle=Math.atan2(dy,dx);
    let speedA=Math.hypot(a.vx,a.vy);
    let speedB=Math.hypot(b.vx,b.vy);

    let dirA=Math.atan2(a.vy,a.vx);
    let dirB=Math.atan2(b.vy,b.vx);

    a.vx=Math.cos(dirB)*speedB;
    a.vy=Math.sin(dirB)*speedB;
    b.vx=Math.cos(dirA)*speedA;
    b.vy=Math.sin(dirA)*speedA;

    // tÃ¡ch bi ra
    let overlap=2*R-dist;
    a.x-=Math.cos(angle)*overlap/2;
    a.y-=Math.sin(angle)*overlap/2;
    b.x+=Math.cos(angle)*overlap/2;
    b.y+=Math.sin(angle)*overlap/2;
  }
}

/* ===== UPDATE ===== */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawTable();

  balls.forEach(b=>{
    b.x+=b.vx;
    b.y+=b.vy;
    b.vx*=FRICTION;
    b.vy*=FRICTION;

    if(Math.abs(b.vx)<0.03) b.vx=0;
    if(Math.abs(b.vy)<0.03) b.vy=0;

    if(b.x<R||b.x>canvas.width-R) b.vx*=-1;
    if(b.y<R||b.y>canvas.height-R) b.vy*=-1;
  });

  ballCollision(white,red);
  ballCollision(white,yellow);
  ballCollision(red,yellow);

  balls.forEach(drawBall);
  drawCue();

  requestAnimationFrame(update);
}

/* ===== MOUSE ===== */
canvas.addEventListener("mousedown",e=>{
  if(white.vx||white.vy) return;
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left;
  const y=e.clientY-r.top;

  if(Math.hypot(x-white.x,y-white.y)<R+5){
    showCue=true;
    aiming=true;
    aimX=x;aimY=y;
    info.innerText="Giá»¯ SPACE Ä‘á»ƒ chá»‰nh lá»±c â€“ tháº£ SPACE Ä‘á»ƒ Ä‘Ã¡nh";
  }else{
    showCue=false;
    aiming=false;
    power=0;
    powerBar.style.width="0%";
  }
});

canvas.addEventListener("mousemove",e=>{
  if(!aiming) return;
  const r=canvas.getBoundingClientRect();
  aimX=e.clientX-r.left;
  aimY=e.clientY-r.top;
});

/* ===== POWER ===== */
window.addEventListener("keydown",e=>{
  if(e.code==="Space" && showCue){
    charging=true;
  }
});
window.addEventListener("keyup",e=>{
  if(e.code==="Space" && showCue){
    const dx=white.x-aimX;
    const dy=white.y-aimY;
    const len=Math.hypot(dx,dy);
    const force=power*0.08;

    white.vx=(dx/len)*force;
    white.vy=(dy/len)*force;

    charging=false;
    showCue=false;
    aiming=false;
    power=0;
    powerBar.style.width="0%";
  }
});

setInterval(()=>{
  if(charging){
    power=Math.min(power+2,MAX_POWER);
    powerBar.style.width=(power/MAX_POWER*100)+"%";
  }
},30);

/* ===== START ===== */
update();
</script>

</body>
</html>
