<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Carom 3 BÄƒng</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{color:#00e5ff}

canvas{
  background:#145214;
  border:15px solid #5b2c06;
  border-radius:10px;
  cursor:crosshair;
}

.info{
  margin-top:10px;
  font-size:16px;
}
</style>
</head>

<body>

<h1>ðŸŽ± Carom 3 BÄƒng</h1>
<canvas id="table" width="900" height="450"></canvas>

<div class="info" id="info">
  KÃ©o chuá»™t tá»« bi tráº¯ng Ä‘á»ƒ Ä‘Ã¡nh
</div>

<script>
const canvas = document.getElementById("table");
const ctx = canvas.getContext("2d");

const R = 10;
let dragging = false;
let aimX = 0, aimY = 0;
let score = 0;

/* ===== BALL ===== */
function Ball(x,y,color){
  this.x=x; this.y=y;
  this.vx=0; this.vy=0;
  this.color=color;
}

let white = new Ball(150,225,"#fff");
let red   = new Ball(450,180,"red");
let yellow= new Ball(600,270,"yellow");
const balls=[white,red,yellow];

/* ===== STATE ===== */
let bands = 0;
let hits = new Set();
let bandLock = {x:false,y:false};

/* ===== DRAW ===== */
function drawBall(b){
  ctx.beginPath();
  ctx.arc(b.x,b.y,R,0,Math.PI*2);
  ctx.fillStyle=b.color;
  ctx.fill();
}

/* ===== PHYSICS ===== */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  balls.forEach(b=>{
    b.x+=b.vx;
    b.y+=b.vy;
    b.vx*=0.985;
    b.vy*=0.985;

    if(Math.abs(b.vx)<0.03) b.vx=0;
    if(Math.abs(b.vy)<0.03) b.vy=0;

    /* BANDS â€“ ONLY WHITE */
    if(b===white){
      if(b.x<R && !bandLock.x){ b.vx*=-1; bands++; bandLock.x=true; }
      if(b.x>canvas.width-R && !bandLock.x){ b.vx*=-1; bands++; bandLock.x=true; }
      if(b.y<R && !bandLock.y){ b.vy*=-1; bands++; bandLock.y=true; }
      if(b.y>canvas.height-R && !bandLock.y){ b.vy*=-1; bands++; bandLock.y=true; }

      if(b.x>R && b.x<canvas.width-R) bandLock.x=false;
      if(b.y>R && b.y<canvas.height-R) bandLock.y=false;
    }else{
      if(b.x<R || b.x>canvas.width-R) b.vx*=-1;
      if(b.y<R || b.y>canvas.height-R) b.vy*=-1;
    }

    drawBall(b);
  });

  collide(white,red);
  collide(white,yellow);
  collide(red,yellow);

  /* AIM */
  if(dragging){
    ctx.beginPath();
    ctx.moveTo(white.x,white.y);
    ctx.lineTo(aimX,aimY);
    ctx.setLineDash([6,6]);
    ctx.strokeStyle="#fff";
    ctx.stroke();
    ctx.setLineDash([]);
  }

  requestAnimationFrame(update);
}

/* ===== COLLISION ===== */
function collide(a,b){
  let dx=b.x-a.x, dy=b.y-a.y;
  let dist=Math.hypot(dx,dy);
  if(dist<2*R){
    let angle=Math.atan2(dy,dx);
    let spA=Math.hypot(a.vx,a.vy);
    let spB=Math.hypot(b.vx,b.vy);

    a.vx=-Math.cos(angle)*spA;
    a.vy=-Math.sin(angle)*spA;
    b.vx=Math.cos(angle)*spB;
    b.vy=Math.sin(angle)*spB;

    if(a===white && bands>=3){
      hits.add(b.color);
      checkScore();
    }
  }
}

/* ===== SCORE ===== */
function checkScore(){
  if(hits.size===2){
    score++;
    info.innerText=`ðŸŽ¯ GHI ÄIá»‚M! | ${bands} bÄƒng | Tá»•ng: ${score}`;
    resetTurn();
  }
}

function resetTurn(){
  bands=0;
  hits.clear();
}

/* ===== CONTROL ===== */
canvas.addEventListener("mousedown",e=>{
  if(white.vx||white.vy) return;
  let r=canvas.getBoundingClientRect();
  let mx=e.clientX-r.left;
  let my=e.clientY-r.top;
  if(Math.hypot(mx-white.x,my-white.y)<R+5) dragging=true;
});

canvas.addEventListener("mousemove",e=>{
  if(!dragging) return;
  let r=canvas.getBoundingClientRect();
  aimX=e.clientX-r.left;
  aimY=e.clientY-r.top;
});

canvas.addEventListener("mouseup",e=>{
  if(!dragging) return;
  let r=canvas.getBoundingClientRect();
  let mx=e.clientX-r.left;
  let my=e.clientY-r.top;
  white.vx=(white.x-mx)/5;
  white.vy=(white.y-my)/5;
  dragging=false;
});

/* ===== START ===== */
update();
</script>



</body>
</html>
